!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LoomSE=t():e.LoomSE=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Script schema","description":"This document outlines the correct formatting for the script schema","type":"object","required":["firstScene","scenes"],"properties":{"shortName":{"type":"string","description":"A short, succinct title","default":""},"longName":{"type":"string","description":"A more verbose name for the script","default":""},"author":{"type":"string","description":"Name of the author","default":""},"description":{"type":"string","description":"A brief description of the story","default":""},"firstScene":{"type":"string","description":"The name of the first scene. Must exist in in scenes object.","default":""},"language":{"type":"string","description":"The default language of the story","examples":["en_GB"]},"scenes":{"type":"object","additionalProperties":{"type":"object","required":["video","events"],"properties":{"longName":{"type":"string","description":"Name of scene","default":""},"video":{"type":"object","required":["sources"],"properties":{"loop":{"properties":{"in":{"type":"integer","description":"Loop in point (in milliseconds)","minimum":0},"out":{"type":"integer","description":"Loop out point (in milliseconds)"}}},"autoplay":{"type":"boolean","description":"Autoplay video on load flag","default":false},"muted":{"type":"boolean","description":"Mute audio","default":false},"sources":{"type":"object","properties":{"mp4":{"type":"string","description":"Relative path to mp4 asset","default":""},"ogg":{"type":"string","description":"Relative path to ogg asset","default":""},"webm":{"type":"string","description":"Relative path to webm asset","default":""},"duration":{"type":"integer","description":"Length of video file"},"subtitles":{"type":"object","additionalProperties":{"type":"string","description":"Relative path to subtitles file","default":""}}}}}},"events":{"type":"array","items":{"$ref":"#/definitions/event"}}}}}},"definitions":{"event":{"type":"object","required":["in","out"],"properties":{"moduleName":{"type":"string","description":"References the external module name","default":""},"disabled":{"type":"boolean","description":"Flag to determine if the module should be disabled","default":false},"in":{"type":"integer","description":"Loop in point (in milliseconds)","default":0,"minimum":0},"out":{"type":"integer","description":"Loop out point (in milliseconds)","default":0},"x":{"type":"number","description":"x representational co-ordinate","default":0,"minimum":0,"maximum":1},"y":{"type":"number","description":"y representational co-ordinate","default":0,"minimum":0,"maximum":1},"payload":{"type":"object","description":"Additional data to pass into the module","default":{},"additionalProperties":true}}}}}')},function(e,t,n){var i;"undefined"!=typeof self&&self,e.exports=(i=n(3),function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={asExpression:function(e,t,n){return"function"!=typeof e?e:e(t,n)},hasProperty:function(e,t){return"object"===(void 0===e?"undefined":i(e))&&Object.prototype.hasOwnProperty.call(e,t)}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={ANY_SCHEMA:{},NOT_ANY_SCHEMA:{not:{}}};e.exports={is:function(e){return"object"===(void 0===e?"undefined":i(e))||"boolean"==typeof e},make:function e(t){if("object"!==(void 0===t?"undefined":i(t))||null===t)return{enum:[t]};if(Array.isArray(t))return{items:t.map(e),additionalItems:!1};var n=Object.keys(t);return{properties:n.reduce(function(n,i){return Object.assign({},n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},i,e(t[i])))},{}),required:n}},transform:function(e){return!0===e?r.ANY_SCHEMA:!1===e?r.NOT_ANY_SCHEMA:e},transformation:r}},function(e,t,n){"use strict";function i(e){var t=e.defineErrors,n=e.index;return"\n    "+(t?"const errors = [];":"")+"\n    "+(n?"let i"+Array.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(n))).map(function(e,t){return t+1}).join(",i")+";":"")+"\n  "}function r(e){var t=e.defineErrors,n=e.lines,r=i(e),s=t?"if(errors.length) return errors;":"";return'\n    "use strict";\n    '+r+"\n    "+n.join("\n")+"\n    "+s+"\n  "}e.exports={body:function(e,t){var n=e.cachedIndex,i=e.lines,s=t.context,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=o.inner,c=o.errorHandler,u={context:s,inner:a,defineErrors:c,index:n,lines:i};return"\n    "+function(e){var t=e.context;if(e.inner||!t.length)return"";var n=[],i=[];return t.forEach(function(e,t){"number"!=typeof e?n.push(t+1+" = "+e):i.push(t+1+" = f"+(e+1))}),"const f"+n.concat(i).join(", f")+";"}(u)+"\n    function f0(data) {\n      "+r(u)+"\n    }\n    return f0;\n  "},restore:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).inner,i=new Function("schema",e)(t);return n||(i.toString=function(){return e}),i},template:function(e,t){function n(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var s=void 0;return n.lines.push(e.replace(/%i/g,function(){return"i"}).replace(/\$(\d)/g,function(e,t){return""+i[t-1]}).replace(/(%[sd])/g,function(){return i.length&&(s=i.shift()),""+s})),n}function i(e){return e.replace("[","").replace("]","").replace("(","").replace(")","").replace("decodeURIComponent","")}function r(){return this.join(".").replace(/\.\[/g,"[")}var s="function"==typeof t.errorHandler?t.errorHandler:function(e){var t=this.data.toString().replace(/^data/,""),n=t.replace(/\['([^']+)'\]/gi,".$1").replace(/\[(i[0-9]*)\]/gi,"['+$1+']"),r="#"+t.replace(/\[i([0-9]*)\]/gi,"/items").replace(/\['([^']+)'\]/gi,"/properties/$1")+"/"+e;return"return {\n        keyword: '"+e+"',\n        dataPath: decodeURIComponent(\""+i(n)+'"),\n        schemaPath: decodeURIComponent("'+i(r)+'")\n      };'};return Object.assign(n,{cachedIndex:0,cached:[],cache:function(e){var t=n.cached[n.cached.length-1];return t[e]?"i"+t[e]:(n.cachedIndex+=1,t[e]=n.cachedIndex,"(i"+t[e]+" = "+e+")")},data:["data"],error:s,lines:[],schema:["schema"],push:n,link:function(t){return"f"+e.link(t)},visit:function(t){n.cached.push({}),e.visit(t,n),n.cached.pop()}}),n.data.toString=r,n.schema.toString=r,n},expression:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var s=i[i.length-1]||{},o=[e[0]];return n.forEach(function(t,n){var r=Number.isInteger(t)?i[t]:s[t];o.push(r,e[n+1])}),o.join("")}}}},function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var r=i(["!/^[a-zA-Z]+$/.test(",")"],["!/^[a-zA-Z]+$/.test(",")"]),s=i(["!/^[a-zA-Z0-9]+$/.test(",")"],["!/^[a-zA-Z0-9]+$/.test(",")"]),o=i(["!/^[-_a-zA-Z0-9]+$/.test(",")"],["!/^[-_a-zA-Z0-9]+$/.test(",")"]),a=i(["!/^[a-fA-F0-9]+$/.test(",")"],["!/^[a-fA-F0-9]+$/.test(",")"]),c=i(["!/^[0-9]+$/.test(",")"],["!/^[0-9]+$/.test(",")"]),u=i(["isNaN(Date.parse(",")) || ~",".indexOf('/')"],["isNaN(Date.parse(",")) || ~",".indexOf(\\'/\\')"]),f=i([""," !== ",".toUpperCase()"],[""," !== ",".toUpperCase()"]),l=i([""," !== ",".toLowerCase()"],[""," !== ",".toLowerCase()"]),d=i(["",".length >= 256 || !/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])(\\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9]))*$/.test(",")"],["",".length >= 256 || !/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\\\-]{0,61}[a-zA-Z0-9])(\\\\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\\\-]{0,61}[a-zA-Z0-9]))*$/.test(",")"]),p=i(["!/^[A-Za-z][A-Za-z0-9+\\-.]*:(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?$/.test(",")"],["!/^[A-Za-z][A-Za-z0-9+\\\\-.]*:(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?$/.test(",")"]),h=i(["!/^[^@]+@[^@]+\\.[^@]+$/.test(",")"],["!/^[^@]+@[^@]+\\\\.[^@]+$/.test(",")"]),m=i(["!/^(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}$/.test(",") || ",'.split(".")[3] > 255'],["!/^(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}$/.test(",") || ",'.split(".")[3] > 255']),y=i(["!/^((?=.*::)(?!.*::.+::)(::)?([\\dA-F]{1,4}:(:|\\b)|){5}|([\\dA-F]{1,4}:){6})((([\\dA-F]{1,4}((?!\\3)::|:\\b|$))|(?!\\2\\3)){2}|(((2[0-4]|1\\d|[1-9])?\\d|25[0-5])\\.?\\b){4})$/.test(",")"],["!/^((?=.*::)(?!.*::.+::)(::)?([\\\\dA-F]{1,4}:(:|\\\\b)|){5}|([\\\\dA-F]{1,4}:){6})((([\\\\dA-F]{1,4}((?!\\\\3)::|:\\\\b|$))|(?!\\\\2\\\\3)){2}|(((2[0-4]|1\\\\d|[1-9])?\\\\d|25[0-5])\\\\.?\\\\b){4})$/.test(",")"]),v=i(["/[^\\\\]\\\\[^.*+?^${}()|[\\]\\\\bBcdDfnrsStvwWxu0-9]/i.test(",")"],["/[^\\\\\\\\]\\\\\\\\[^.*+?^\\${}()|[\\\\]\\\\\\\\bBcdDfnrsStvwWxu0-9]/i.test(",")"]),A=i(["!/^$|^\\/(?:~(?=[01])|[^~])*$/i.test(",")"],["!/^$|^\\\\/(?:~(?=[01])|[^~])*$/i.test(",")"]),b=i(["!/^(?:[A-Za-z][A-Za-z0-9+\\-.]*:(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?|(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?)$/i.test(",")"],["!/^(?:[A-Za-z][A-Za-z0-9+\\\\-.]*:(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?|(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?)$/i.test(",")"]),g=i(["!/^(?:(?:[^\\x00-\\x20\"'<>%\\\\^`{|}]|%[0-9a-f]{2})|\\{[+#.\\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\:[1-9][0-9]{0,3}|\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\:[1-9][0-9]{0,3}|\\*)?)*\\})*$/i.test(",")"],["!/^(?:(?:[^\\\\x00-\\\\x20\"\\'<>%\\\\\\\\^\\`{|}]|%[0-9a-f]{2})|\\\\{[+#.\\\\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\\\:[1-9][0-9]{0,3}|\\\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\\\:[1-9][0-9]{0,3}|\\\\*)?)*\\\\})*$/i.test(",")"]),F=n(2),w=F.expression;e.exports={alpha:w(r,"data"),alphanumeric:w(s,"data"),identifier:w(o,"data"),hexadecimal:w(a,"data"),numeric:w(c,"data"),"date-time":w(u,"data","data"),uppercase:w(f,"data","data"),lowercase:w(l,"data","data"),hostname:w(d,"data","data"),uri:w(p,"data"),email:w(h,"data"),ipv4:w(m,"data","data"),ipv6:w(y,"data"),regex:w(v,"data"),"json-pointer":w(A,"data"),"uri-reference":w(b,"data"),"uri-template":w(g,"data")}},function(e,t,n){"use strict";var i=n(11),r=n(12),s=n(13),o=n(14),a=n(16),c=n(17),u=n(18),f=n(19),l=n(20),d=n(21),p=n(22),h=n(23),m=n(24),y=n(25),v=n(26),A=n(27);e.exports={name:{$ref:a,required:i,format:r,property:s,type:o,not:c,anyOf:u,oneOf:f,allOf:l,dependencies:d,properties:p,patternProperties:h,items:m,contains:y,constant:v,propertyNames:A},list:[a,i,r,s,o,c,u,f,l,d,p,h,m,y,v,A]}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={readOnly:"false",exclusiveMinimum:function(e){return"%s <= "+e.exclusiveMinimum},minimum:function(e){return"%s < "+e.minimum},exclusiveMaximum:function(e){return"%s >= "+e.exclusiveMaximum},maximum:function(e){return"%s > "+e.maximum},multipleOf:'($1/$2) % 1 !== 0 && typeof $1 === "number"',pattern:function(e){var t=void 0,n=void 0;return"string"==typeof e.pattern?t=e.pattern:(t=e.pattern[0],n=e.pattern[1]),'typeof ($1) === "string" && !'+new RegExp(t,n)+".test($1)"},minLength:'typeof $1 === "string" && function dltml(b,c){for(var a=0,d=b.length;a<d&&c;){var e=b.charCodeAt(a++);55296<=e&&56319>=e&&a<d&&56320!==(b.charCodeAt(a++)&64512)&&a--;c--}return!!c}($1, $2)',maxLength:'typeof $1 === "string" && function dmtml(b,c){for(var a=0,d=b.length;a<d&&0<=c;){var e=b.charCodeAt(a++);55296<=e&&56319>=e&&a<d&&56320!==(b.charCodeAt(a++)&64512)&&a--;c--}return 0>c}($1, $2)',minItems:"$1.length < $2 && Array.isArray($1)",maxItems:"$1.length > $2 && Array.isArray($1)",uniqueItems:function(e,t){return e.uniqueItems?(t(t.cache("{}")),'Array.isArray($1) && $1.some(function(item, key) {\n      if(item !== null && typeof item === "object") key = JSON.stringify(item);\n      else key = item;\n      if('+t.cache("{}")+".hasOwnProperty(key)) return true;\n      "+t.cache("{}")+"[key] = true;\n    })"):"true"},minProperties:'!Array.isArray($1) && typeof $1 === "object" && Object.keys($1).length < $2',maxProperties:'!Array.isArray($1) && typeof $1 === "object" && Object.keys($1).length > $2',enum:function(e,t){return e.enum.map(function(e){var n="$1",r=e;return"object"===(void 0===e?"undefined":i(e))?(r="'"+JSON.stringify(e)+"'",n=t.cache("JSON.stringify($1)")):"string"==typeof e&&(r="'"+encodeURIComponent(e)+"'"),n+" != decodeURIComponent("+r+")"}).join(" && ")}}},function(e,t,n){"use strict";e.exports=["$ref","$schema","type","not","anyOf","allOf","oneOf","properties","patternProperties","additionalProperties","items","additionalItems","required","default","title","description","definitions","dependencies","$id","contains","const","examples"]},function(e,t,n){"use strict";function i(e){return r.test(e)}var r=/:\/\//,s=/#\/?/,o=/(^[^:]+:\/\/[^?#]*\/).*/;e.exports={makePath:function(e){return e.filter(function(e){return"string"==typeof e}).reduce(function(e,t){if(!e.length||i(t))return t;if(!t)return e;if(0===t.indexOf("#")){var n=e.indexOf("#");return-1===n?e+t:e.slice(0,n)+t}var r=function(e){return e.replace(o,"$1")}(e)+t;return r+(-1===r.indexOf("#")?"#":"")},"")},isFullUri:i,head:function(e){return"string"!=typeof e?e:e.split(s)[0]},fragment:function(e){return"string"!=typeof e?e:e.split(s)[1]},normalize:function(e){return decodeURIComponent(e.replace(/~1/g,"/").replace(/~0/g,"~"))},keys:{id:"$id"}}},function(e,t,n){e.exports=n(9)},function(e,t,n){"use strict";function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof i))return new i(e);this.options=e,this.resolved={},this.state=new l(null,this),this.useVersion(e.version,e.versionConfigure),this.addFormat(e.formats)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(2),o=s.restore,a=s.expression,c=n(3),u=n(10),f=u.generate,l=u.State,d=n(28),p=d.add,h=d.use;Object.assign(i,{expression:a}),Object.assign(i.prototype,{validate:function(e,t){return this.resolve(e).fn(t)},addSchema:function(e,t){var n=this,i="object"===(void 0===e?"undefined":r(e))?e:t,s={schema:i,fn:f(this,i,void 0,this.options)};return[e,t.id].filter(function(e){return"string"==typeof e}).forEach(function(e){n.resolved[e]=Object.assign({name:e},s)}),s},removeSchema:function(e){e?delete this.resolved[e]:this.resolved={}},resolve:function(e){return"object"!==(void 0===e?"undefined":r(e))&&this.resolved[e]?this.resolved[e]:this.addSchema(e,this.state.resolve(e))},export:function(e){var t=this,n=void 0;return e?(n=this.resolve(e),n={name:e,schema:n.schema,fn:n.fn.toString()}):(n={},Object.keys(this.resolved).forEach(function(e){n[e]={name:e,schema:t.resolved[e].schema,fn:t.resolved[e].fn.toString()}})),JSON.stringify(n)},import:function(e){var t=this,n=JSON.parse(e),i=n;n.name&&n.fn&&n.schema&&(i=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n.name,n)),Object.keys(i).forEach(function(e){var n=i[e],r=n.name,s=n.schema,a=n.fn,c=o(a,s,t.options);t.resolved[r]={name:r,schema:s,fn:c}})},addFormat:function(e,t){"string"!=typeof e?"object"===(void 0===e?"undefined":r(e))&&Object.assign(c,e):c[e]=t},setErrorHandler:function(e){Object.assign(this.options,{errorHandler:e})},useVersion:function(e,t){"function"!=typeof t&&"draft-04"===e&&(t=n(29)),"function"==typeof t&&p(e,t),h(e)}}),e.exports=i},function(e,t,n){"use strict";function i(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments[1]);Object.assign(this,{context:[],entries:new Map,env:e})}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i(t,e),r=arguments[3],s=f(n,r);s.visit(t);var o=c(s,n,r);return u(o,t,r)}var s=n(4),o=s.list,a=n(2),c=a.body,u=a.restore,f=a.template,l=n(0),d=l.hasProperty,p=n(7),h=p.normalize,m=p.makePath,y=p.head,v=p.isFullUri,A=p.fragment,b=p.keys,g=n(1),F=g.is,w=g.transform;i.prototype=Object.assign(Object.create(Array.prototype),{addEntry:function(e,t){var n=this.entries.get(t);return!1===n?this.context.push(t):(void 0===n&&(this.entries.set(t,!1),n=r(this.env,t,this,{inner:!0}),this.entries.set(t,n),this.revealReference(t)),this.context.push(n))},revealReference:function(e){for(var t=this.context.indexOf(e);-1!==t;t=this.context.indexOf(e))this.context[t]=this.context.length},link:function(e){var t=this.resolve(e);return this.addEntry(e,t)},resolveReference:function(e){if(v(e))return e;for(var t=void 0,n=void 0,i=this.length-1;i>=0;i-=1,t=!1){var r=this[i],s=r[b.id],o=r.$ref;if(v(t=s||o)){n=i;break}}for(var a=[],c=this.length-1;c>n;c-=1){var u=this[c],f=u[b.id],l=u.$ref,d=f||l;y(d)&&a.push(d)}return m([t].concat(a,[e]))},ascend:function(e){for(var t=y(e),n=this.env.resolved[t]||{},i=n.schema,r=void 0===i?this[0]:i;r.$ref&&y(r.$ref)!==y(e)&&1===Object.keys(r).length;)r=this.ascend(r.$ref);return r},descend:function(e,t){var n=this,i=A(e);if(!i&&v(e))return t;i||(i=e);var r=i.split("/"),s=r.map(h).reduce(function(e,t,i){var s=e[t];return F(s)||(s=e.definitions&&e.definitions[t]),i!==r.length-1&&d(s,b.id)&&n.push(s),s},t);return F(s)?s:t},resolve:function(e){if("string"!=typeof e)return e;var t=this.resolveReference(e),n=this.ascend(t);return this.descend(e,n)},visit:function(e,t){var n=w(e),i=this.length;this.push(n),o.some(function(e){return e(n,t)}),this.length=i}}),e.exports={State:i,generate:r}},function(e,t,n){"use strict";e.exports=function(e,t){Array.isArray(e.required)&&t("if ("+t.data+" !== null && typeof "+t.data+" === 'object' && !Array.isArray("+t.data+")) {\n    "+e.required.map(function(e){return"if (!"+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(e)+'"))) '+t.error("required",e)}).join("")+"\n  }")}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){if(void 0!==e.format){var n=i[e.format];"function"==typeof n&&t("if ("+n({data:t.data,schema:e})+") "+t.error("format"))}}},function(e,t,n){"use strict";var i=n(5),r=n(6),s=n(0),o=s.asExpression;e.exports=function(e,t){Object.keys(e).forEach(function(n){if(-1===r.indexOf(n)&&"format"!==n){var s=o(i[n],e,t);if(s){var a=t.error(n);t("if ("+s+") "+a,t.data,e[n])}}})}},function(e,t,n){"use strict";var i=n(15),r=n(0),s=r.hasProperty;e.exports=function(e,t){if(s(e,"type")){var n=t.error("type",e.type);t("if (("+[].concat(e.type).map(function(e){return i[e]}).join(") && (")+")) "+n,t.data)}}},function(e,t,n){"use strict";e.exports={null:"%s !== null",string:'typeof %s !== "string"',boolean:'typeof %s !== "boolean"',number:'typeof %s !== "number" || %s !== %s',integer:'typeof %s !== "number" || %s % 1 !== 0',object:'!%s || typeof %s !== "object" || Array.isArray(%s)',array:"!Array.isArray(%s)",date:"!(%s instanceof Date)"}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){return!!r(e,"$ref")&&(t("if ("+t.link(e.$ref)+"("+t.data+")) "+t.error("$ref")),!0)}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){r(e,"not")&&t("if (!"+t.link(e.not)+"("+t.data+")) "+t.error("not"))}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){if(r(e,"anyOf")){var n=t.error("anyOf"),i=e.anyOf.map(function(e){return t.link(e)+"("+t.data+")"}).join(" && ");t("if ("+i+") "+n)}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){if(r(e,"oneOf")){var n=e.oneOf.map(function(e){return t.link(e)}),i=t.cache("["+n+"]"),s=t.cache("["+n+"]"),o=t.cache(s+".length - 1"),a=t.cache(s+".length - 1"),c=t.cache("0"),u=t.cache("0"),f=t.error("oneOf");t("for (\n    "+i+", "+o+", "+c+";\n    "+a+" >= 0 && "+a+" < "+s+".length;\n    "+a+"--) {\n      if(!"+s+"["+a+"]("+t.data+")) "+u+"++;\n    }\n    if ("+u+" !== 1) "+f+"\n  ")}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){if(r(e,"allOf")){var n=t.error("allOf"),i=e.allOf.map(function(e){return t.link(e)+"("+t.data+")"}).join(" || ");t("if ("+i+") "+n)}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty,s=n(1),o=s.is;e.exports=function(e,t){r(e,"dependencies")&&Object.keys(e.dependencies).forEach(function(n){var i=e.dependencies[n],r=t.error("dependencies");t("if ("+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(n)+'"))) {'),Array.isArray(i)||"string"==typeof i?[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i)).map(function(e){return"if (!"+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(e)+'"))) '+r}).map(t):o(i)&&t.visit(i),t("}")})}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(0),s=r.hasProperty;e.exports=function(e,t){s(e,"properties")&&"object"===i(e.properties)&&Object.keys(e.properties).forEach(function(n){var r=e.properties[n];if("object"!==(void 0===r?"undefined":i(r))||Object.keys(r).length){var s=!e.required||-1===e.required.indexOf(n);s&&t("if ("+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(n)+'"))) {'),t.data.push("[decodeURIComponent('"+encodeURIComponent(n)+"')]"),t.visit(r),t.data.pop(),s&&t("}")}})}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){var n=r(e,"additionalProperties")&&!0!==e.additionalProperties,i=r(e,"patternProperties");if(n||i){t("if(typeof "+t.data+" === 'object' && !Array.isArray("+t.data+")) {"),t(t.cache("null"));var s=t.cache("null"),o=function(){!1===e.additionalProperties?t(t.error("additionalProperties")):e.additionalProperties&&(t.data.push("["+s+"]"),t.visit(e.additionalProperties),t.data.pop())};t("for ("+s+" in "+t.data+") {"),n&&i&&t(t.cache("false")),i?Object.keys(e.patternProperties).forEach(function(i){t("if ("+new RegExp(i)+".test("+s+")) {"),n&&t(t.cache("false")+" = true;");var r=e.patternProperties[i];t.data.push("["+s+"]"),t.visit(r),t.data.pop(),t("}"),e.properties?t("if ("+(n?t.cache("false")+" || ":"")+" "+t.schema+".properties.hasOwnProperty("+s+")) continue;"):n&&t("if ("+t.cache("false")+") continue;"),o()}):(e.properties&&t("if("+t.schema+".properties.hasOwnProperty("+s+")) continue;"),o()),t("}}")}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(0),s=r.hasProperty;e.exports=function(e,t){if(s(e,"items")){var n=e.items.length,r=t.error("additionalItems"),o=t.data;if(t("if(Array.isArray("+o+")) {"),Array.isArray(e.items)){if(!1===e.additionalItems&&t("if ("+o+".length > "+n+") "+r),e.items.forEach(function(e,n){t("if("+o+".length > "+n+") {"),o.push("["+n+"]"),t.visit(e),o.pop(),t("}")}),"object"===i(e.additionalItems)){var a=t.cache(n),c=t.cache(n);t("for ("+a+"; "+c+" < "+o+".length; "+c+"++) {"),o.push("["+t.cache(n)+"]"),t.visit(e.additionalItems),o.pop(),t("}")}}else{var u=t.cache("0"),f=t.cache("0");t("for ("+u+"; "+f+" < "+o+".length; "+f+"++) {"),o.push("["+f+"]"),t.visit(e.items),o.pop(),t("}")}t("}")}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){if(r(e,"contains")){var n=t.error("contains"),i=""+t.link(e.contains),s=t.data,o=t.cache("0"),a=t.cache("0");t("if (Array.isArray("+s+")) {\n    if ("+s+".length === 0) "+n+"\n      for ("+o+"; "+a+" < "+s+".length; "+a+"++) {\n        if (!"+i+"("+s.toString.apply(s.concat("["+a+"]"))+")) break;\n        if ("+a+" === "+s+".length - 1) "+n+"\n      }\n  }")}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty,s=n(1),o=s.make;e.exports=function(e,t){if(r(e,"const")){var n=o(e.const);t.visit(n)}}},function(e,t,n){"use strict";var i=n(0),r=i.hasProperty;e.exports=function(e,t){if(r(e,"propertyNames")){var n=t.link(e.propertyNames),i=t.error("propertyNames");t("if (Object.keys("+t.data+").some("+n+")) "+i)}}},function(e,t,n){"use strict";var i=n(5),r=n(6),s=n(4),o=n(3),a=n(7),c=a.keys,u=n(1),f=u.transformation,l={};e.exports={add:function(e,t){l[e]=t},use:function(e){e&&l[e]&&(0,l[e])({properties:i,keywords:r,validators:s,formats:o,keys:c,transformation:f})}}},function(e,t){e.exports=i}]))},function(e){e.exports=JSON.parse('{"private":false,"name":"loomse","version":"0.5.6","description":"Interactive storytelling for the modern web","author":"Franco Speziali","license":"GPL-3.0","homepage":"http://www.loomse.org/","repository":{"type":"git","url":"https://github.com/WeMakeMachines/loomse.git"},"main":"dist/loomse.min.js","scripts":{"dev":"webpack --config webpack.config.js --devtool=\'source-map\' --watch --mode=\'development\'","build":"webpack --config webpack.config.js --mode=\'production\' -o dist/loomse.min.js","prettier":"prettier --write \'source/**/*.js\'","eslint":"eslint source","test":"jest"},"devDependencies":{"@babel/cli":"^7.5.5","@babel/core":"^7.5.5","@babel/preset-env":"^7.5.5","babel-eslint":"^10.0.2","babel-jest":"^24.8.0","babel-loader":"^8.0.6","eslint":"^6.0.1","jest":"^24.8.0","prettier":"1.17.1","webpack":"^4.35.0","webpack-cli":"^3.3.4"},"dependencies":{"djv":"^2.1.3-alpha.0"}}')},function(e,t,n){!function(){"use strict";e.exports=function(e){var t=e.properties,n=e.keywords,i=e.validators,r=e.formats,s=e.keys,o=e.transformation;Object.assign(t,{minimum:function(e){return"%s <"+(e.exclusiveMinimum?"=":"")+" "+e.minimum},maximum:function(e){return"%s >"+(e.exclusiveMaximum?"=":"")+" "+e.maximum}}),delete t.exclusiveMaximum,delete t.exclusiveMinimum,["$id","contains","const","examples"].forEach(function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}),-1===n.indexOf("exclusiveMaximum")&&n.push("exclusiveMaximum","exclusiveMininum","id"),["contains","constant","propertyNames"].forEach(function(e){var t=i.name[e];delete i.name[e];var n=i.list.indexOf(t);-1!==n&&i.list.splice(n,1)}),delete r["json-pointer"],delete r["uri-reference"],delete r["uri-template"],Object.assign(s,{id:"id"}),Object.assign(o,{ANY_SCHEMA:!0,NOT_ANY_SCHEMA:!1})}}()},function(e,t,n){"use strict";n.r(t);class i{static vendorAPI(){return{universal:{isAvailable:"fullscreenEnabled",request:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange"},webkit:{isAvailable:"webkitFullscreenEnabled",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",event:"webkitfullscreenchange"},moz:{isAvailable:"mozFullScreenEnabled",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",event:"mozfullscreenchange"},ms:{isAvailable:"msFullscreenEnabled",request:"msRequestFullscreen",exit:"msExitFullscreen",event:"MSFullscreenChange"}}}static returnVendorAPI(){let e=this.vendorAPI(),t=Object.keys(e);for(let n=0;n<t.length;n+=1){let i=e[t[n]],r=i.isAvailable;if(document[r])return i}return null}constructor(e){this.element=e,this.root=document,this.state=!1,this.api=this.constructor.returnVendorAPI(),this.isAvailable=Boolean(this.api)}toggle(){if(!this.isAvailable)throw new Error("Fullscreen not available on this device");this.state?this.exit():this.request(this.element)}request(e){e[this.api.request](),this.state=!0}exit(){this.root[this.api.exit](),this.state=!1}returnEvent(){return this.api.event||null}}class r extends Error{}const s={fullscreen:e=>new i(e),getWindowDimensions:()=>({width:window.innerWidth,height:window.innerHeight}),hasSmallScreen(e){let t=this.getWindowDimensions();return t.width<e||t.height<e},isCompatible(){return this.supportsVideo()},supportsVideo(){let e=document.createElement("video").canPlayType;return Boolean(e)},getExternalModule(e,t){if(!e)return;const n=window[e][t];if(!n)throw new Error("No modules found");return n},localStorage:new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;this.ref=e,this.storageKey="data",this.data={},this.isAvailable=this.checkIsAvailable()}checkIsAvailable(){try{return this.isAvailable=!0,this.ref.localStorage.setItem("test",{}),this.ref.localStorage.removeItem("test"),!0}catch(e){throw new r("Unable to access local storage, ".concat(e))}}getData(){if(!this.isAvailable)return;const e=this.ref.localStorage.getItem(this.storageKey);return e?(this.data=JSON.parse(e),this.data):void 0}saveData(e,t){if(!this.isAvailable)return;this.data[e]||(this.data[e]=[]),this.data[e].push(t);const n=JSON.stringify(this.data);try{this.ref.localStorage.setItem(this.storageKey,n)}catch(e){throw new r("Unable to access local storage, ".concat(e))}}}};class o{constructor(e){this.antenna=e}broadcast(e,t){const n=new CustomEvent(e,{detail:t});this.antenna.dispatchEvent(n)}listen(e,t){this.antenna.addEventListener(e,t)}stopListening(e,t){this.antenna.removeEventListener(e,t)}}let a;class c extends Error{}class u{static createNode(e){e.type||(e.type="div");const t=document.createElement(e.type);if(e.id&&document.getElementById(e.id))throw new c("DOM element already exists");return e.id&&t.setAttribute("id",e.id),t}constructor(e){e=e||{},this.node=e.node&&"object"==typeof e.node?e.node:this.constructor.createNode(e),this.mounted=!1,this.parent=e.parent||null,this.visible=e.visible||!0,this.textNode=e.text?document.createTextNode(e.text):null,this._childRegistry=e.children||[],this._eventHandlerRegistry={},this.visible||this.hide(),this.textNode&&this.node.appendChild(this.textNode),e.class&&this.setClass(e.class),e.layer&&this.setLayer(e.layer),e.styles&&this.setStyles(e.styles),this.setStyles({position:"absolute",top:0,left:0})}get children(){return this._childRegistry}attach(e){this._childRegistry.push(e),this.node.appendChild(e.node),e.mounted=!0,e.parent=this.node}removeChildren(){this._childRegistry.forEach(e=>{e.mounted&&(e.unmount(),e.mounted=!1)})}mount(e){let t;if(this.mounted)throw new c("Component already mounted");if(!this.parent&&!e)throw new c("Parent not found");if(this.parent&&"object"==typeof this.parent)return this.parent.appendChild(this.node),void(this.mounted=!0);if("object"==typeof e.node&&(t=e.node),e.id&&(t=document.getElementById(e.id)),e.selector&&(t=document.querySelector(e.selector)),!t||"object"!=typeof t)throw new c("Parent not found");t.appendChild(this.node),this.mounted=!0,this.parent=t}mountToBody(){if(this.parent)throw new c("Component already mounted");const e=document.querySelector("body");if(!e)throw new c("DOM not ready");e.appendChild(this.node),this.mounted=!0,this.parent=e}unmount(){if(!this.parent)throw new c("Parent not found");this.mounted&&this.parent.removeChild(this.node)}setClass(e){if(!e||"string"!=typeof e&&!Array.isArray(e))throw new c("[Element] invalid parameters");(e="string"==typeof e?[e]:e).forEach(e=>{this.node.classList.add(e)})}setAttributes(e){if("object"!=typeof e)throw new c("Invalid attributes");for(const t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t])}setStyles(e){if("object"!=typeof e)throw new c("Invalid properties");for(let t in e)if(e.hasOwnProperty(t)){let n=e[t];if("number"==typeof n)switch(t){case"width":case"height":case"top":case"left":case"right":case"bottom":n+="px"}this.node.style[t]=n}}setText(e){if(!e||"string"!=typeof e)throw new c("Invalid string");let t=document.createTextNode(e);this.node.appendChild(t)}setHtml(e){if(!e||"string"!=typeof e)throw new c("Invalid HTML");this.node.innerHTML=e}setLayer(e){this.setStyles({zIndex:e})}resize(e){this.setStyles({width:e.width,height:e.height})}show(){this.setStyles({visibility:"visible"})}hide(){this.setStyles({visibility:"hidden"})}getDimensions(){const e=document.getElementsByTagName("body")[0],t=this.node.cloneNode(!0);t.setAttribute("style","display: inline-block !important; position: absolute; left: 0; top: 0; z-index: -100"),e.appendChild(t);const n={width:t.clientWidth,height:t.clientHeight};return e.removeChild(t),n}setPositionFromPercentage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((e<0||e>1)&&(e=0),(t<0||t>1)&&(t=0),!this.parent)return void console.warn("Unable to set position; no parent set");const n=this.parent.offsetWidth-this.node.offsetWidth,i=this.parent.offsetHeight-this.node.offsetHeight,r={x:Math.round(n*e),y:Math.round(i*t)};this.setStyles({left:r.x,top:r.y})}listenToChannel(e,t){this._eventHandlerRegistry[e]?console.warn("Already listening to channel, ",e):(this._eventHandlerRegistry[e]=t.bind(this),a.listen(e,this._eventHandlerRegistry[e]))}stopListeningToChannel(e){this._eventHandlerRegistry[e]?(a.stopListening(e,this._eventHandlerRegistry[e]),delete this._eventHandlerRegistry[e]):console.warn("Handler not found, ",e)}}class f extends u{constructor(e){super(e),this.x=e.x,this.y=e.y}render(){this.mount(),this.x&&this.y&&this.setPositionFromPercentage(this.x,this.y)}}const l="expired",d="fired",p="waiting";class h{constructor(e){this.id=e.id,this.state=p,this.module="function"==typeof e.module?e.module:null,this.disabled=e.disabled,this.in=e.in,this.out=e.out,this.x=e.x,this.y=e.y,this.payload=e.payload,this.parent=e.parent,this.element=new f({type:"div",id:"module-".concat(e.id),x:e.x,y:e.y,parent:e.parent})}run(){this.module&&(this.module().run(this.payload,this.element.node,()=>this.element.render()),this.state=d)}stop(){this.module&&(this.module().stop(),this.element.unmount(),this.state=l)}}const m="director:play",y="director:pause",v="video:timeupdate",A="stage:resize",b="run",g="stop";function F(e,t){return new Promise((n,i)=>{let r=new XMLHttpRequest;r.open("GET",e),r.send(),r.onload=()=>{if(200===r.status)switch(t){case"JSON":n(JSON.parse(r.responseText));break;default:n(r.responseText)}else i(r.status)},r.onerror=()=>{i("File or network error")}})}const w=(()=>{let e;return(t,n)=>{e&&clearTimeout(e),e=setTimeout(()=>{t()},n)}})();const x="srt";class O{static getBlockMarker(e){const t=Number(e);if(0!==t&&!isNaN(t))return t}static getTimes(e){if(-1===e.indexOf("--\x3e"))return;const t=e.split("--\x3e");return{in:z(t[0]),out:z(t[1])}}constructor(e){this.rawText=e,this.lines=this.processLines(),this.blocks=this.processBlocks()}processLines(){return this.rawText.split("\n")}processBlocks(){let e=0;return this.lines.reduce((t,n)=>{const i=this.constructor.getBlockMarker(n),r=this.constructor.getTimes(n),s=t[t.length-1];return i&&i===e+1?(e+=1,t.push({payload:{index:i,text:""}})):r?(s.in=r.in,s.out=r.out):s.payload.text+=n,t},[])}}async function j(e,t){if(!e||"string"!=typeof e)return;t=t||function(e){return e.split("/").pop().split(".").pop().toLowerCase()}(e);const n=await F(e);let i;switch(t){case x:i=await(r=n,new Promise((e,t)=>{"string"!=typeof r&&t();const n=new O(r),i=n.blocks;i||t(),e(n.blocks)}));break;default:Promise.reject("Unable to parse file")}var r;return Promise.resolve(i)}const S=60,$=60,P=1e3;function _(e){return e*P}function z(e,t){t=Object.assign({},t,{major:":",minor:","});const n=e.split(t.major),i=n.pop().split(t.minor),r=Number(n[0]),s=Number(n[1]),o=Number(i[0]),a=Number(i[1]);let c=r*S;return c=((c=(c+s)*$)+o)*P,c+=a}class E extends u{constructor(e,t,n){super({id:e,styles:t}),this.activeEvents={},this.queue=new Fe(n),this.listenToChannel(v,this.isReadyToAction)}stopListeningToRadio(){this.stopListeningToChannel(v)}isReadyToAction(e){if(!e.detail.time)return;const t=_(e.detail.time);t&&this.queue.pending&&t>=this.queue.pending.time&&this.parseAction(this.queue.pending)}parseAction(e){switch(e.action){case b:this.run(e);break;case g:this.stop(e);break;default:return}this.queue.advance()}run(){}stop(){}}const Z={width:"100%",height:"100%",position:"absolute",left:0,top:0};function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var N={events:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(n,!0).forEach(function(t){C(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Z)};function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class D extends E{constructor(e){super("events",N.events,e),this.listenToChannel(A,this.resizeEvents)}resizeEvents(){for(const e in this.activeEvents)this.activeEvents.hasOwnProperty(e)&&this.activeEvents[e].element.setPositionFromPercentage(this.activeEvents[e].x,this.activeEvents[e].y)}run(e){this.activeEvents[e.id]=new h(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(n,!0).forEach(function(t){R(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:e.id,parent:this.node},this.queue.getTimedObject(e.id))),this.activeEvents[e.id].run()}stop(e){this.activeEvents[e.id].stop(),delete this.activeEvents[e.id]}}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(n,!0).forEach(function(t){q(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const L={externalModules:"",mobile:{minimumResolution:480},subtitles:{active:!1,x:.5,y:.9}};let U=M({},L);function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var J={subtitles:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(n,!0).forEach(function(t){B(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Z),subtitle:{display:"block",textAlign:"center",fontSize:"19px",color:"#ffffff",fontFamily:"Roboto, sans-serif"}};class V extends E{constructor(e){super("subtitles",J.subtitles,e)}run(e){const t=this.queue.getTimedObject(e.id);this.activeEvents[e.id]=new f({type:"p",id:"subtitle-".concat(e.id),styles:J.subtitle,x:U.subtitles.x,y:U.subtitles.y,text:t.payload.text,parent:this.node}),this.activeEvents[e.id].render()}stop(e){this.activeEvents[e.id].unmount(),delete this.activeEvents[e.id]}}const W="mp4",Y="ogg",G="webm",K="video/mp4",X="video/ogg",Q="video/webm";class ee extends Error{}class te{static mapFileFormatToMediaType(e){switch(e){case W:return K;case Y:return X;case G:return Q;default:throw new ee("Unable to process source in Video file")}}constructor(e,t){this.element=new u({type:"source"}),this.element.setAttributes({src:t,type:this.constructor.mapFileFormatToMediaType(e)})}}const ne=new class{constructor(e){this._time=e.time,this._scene=e.scene,this._clientDimensions=e.clientDimensions,this._history=e.history,this._events=e.events,this._language=e.language}get events(){return this._events}set events(e){this._events=e}get time(){return this._time}set time(e){this._time=e}get scene(){return this._scene}set scene(e){this._scene=e}get language(){return this._language}set language(e){this._language=e}get clientDimensions(){return this._clientDimensions}set clientDimensions(e){"object"==typeof e&&(this._clientDimensions.width=e.width,this._clientDimensions.height=e.height)}addToHistory(e){this._history.push(e)}}({time:0,clientDimensions:{width:null,height:null},scene:"",events:[],history:[],language:"en_GB"});function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var se={video:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(n,!0).forEach(function(t){re(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},Z)};class oe extends Error{}class ae extends u{constructor(e){super({type:"video",styles:se.video}),this.node.autoplay=!1,this.node.controls=e.controls,this.node.loop=e.loop,this.node.muted=e.muted||!1,this.sources=this.setSources(e.sources),this.mountSources(),this.registerMediaEvents(),this.listenToChannel(y,this.pause),this.listenToChannel(m,this.play),e.autoplay&&this.play()}setSources(e){if(!e)throw new oe("No video sources found");const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=new te(n,e[n]));return t}mountSources(){for(const e in this.sources){if(!this.sources.hasOwnProperty(e))continue;this.sources[e].element.mount({node:this.node})}}registerMediaEvents(){["playing","paused","seeking","seeked","timeupdate","ended"].forEach(e=>{this.node.addEventListener(e,()=>{a.broadcast("video:".concat(e),{state:e,time:this.node.currentTime})})})}stopListeningToRadio(){this.stopListeningToChannel(y),this.stopListeningToChannel(m)}play(){this.node.play().then(()=>{this.resize({width:ne.clientDimensions.width,height:ne.clientDimensions.height})}).catch(()=>{})}pause(){this.node.pause()}playPause(){return this.node.paused?(this.play(),!0):(this.pause(),!1)}}class ce extends u{constructor(e){super(e)}}class ue extends u{constructor(e){super(e)}}var fe={view:{zIndex:0,backgroundColor:"#170508"}};class le extends u{constructor(e){super({node:e,styles:fe.view}),this.fullscreen=s.fullscreen(this.node),this.containers={stage:new ce({id:"stage",layer:0}),overlay:new ue({id:"overlay",layer:1})},this.mountContainers(),this.mountToBody(),this.setListeners(),this.resizeComponents()}mountContainers(){for(const e in this.containers){if(!this.containers.hasOwnProperty(e))continue;this.containers[e].mount({node:this.node})}}setListeners(){const e=this.fullscreen.returnEvent(),t=this.resizeComponents.bind(this);window.addEventListener("resize",function(){w(t,200)}),e&&document.addEventListener(e,function(){t()})}resizeComponents(){ne.clientDimensions=s.getWindowDimensions();const e=[this,this.containers.stage,this.containers.overlay,...this.containers.stage.children,...this.containers.overlay.children];for(let t=0;t<e.length;t+=1){e[t].resize({width:ne.clientDimensions.width,height:ne.clientDimensions.height})}a.broadcast(A,{width:ne.clientDimensions.width,height:ne.clientDimensions.height})}}let de;class pe{constructor(e){this.longName=e.longName,this.video=new ae(e.video),this.events=new D(this.parseEvents(e.events)),this.mountComponents(this.video,this.events),U.subtitles.active&&j(e.video.subtitles[ne.language]).then(e=>{this.subtitles=new V(e),this.mountComponents(this.subtitles)}).catch(e=>{console.warn(e)})}parseEvents(e){return e.map(e=>{const t=s.getExternalModule(U.externalModules,e.moduleName);return t&&(e.module=t),e})}mountComponents(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(e=>de.containers.stage.attach(e))}unmountComponents(){this.video.stopListeningToRadio(),this.events.stopListeningToRadio(),de.containers.stage.removeChildren()}}var he=n(0),me=n(1),ye=n.n(me);class ve extends Error{}class Ae{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:he;this.scriptUri=e,this.schema=t}load(){return new Promise(e=>{this.fetchScript().then(t=>e(t)).catch(e=>{throw new ve("Unable to read script, ".concat(e))})})}validate(e){const t=new ye.a;t.addSchema("script",this.schema);const n=t.validate("script",e);if(!n)return!0;throw new ve("Script error, does not match schema, ".concat(JSON.stringify(n)))}fetchScript(){return F(this.scriptUri,"JSON")}}class be extends Error{}class ge{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:U;this.scriptReader=new Ae(this.getScriptUri(e)),this.script={},this.shortName="",this.longName="",this.author="",this.description="",this.firstScene="",this.scenes={},this.language=""}getScriptUri(e){if(!e.script)throw new be("No script file to load");return e.mobileScript&&s.hasSmallScreen()?e.mobileScript:e.script}async readScript(){if(this.script=await this.scriptReader.load(),!this.scriptReader.validate(this.script))throw new be("Unable to continue");this.parseScriptParameters(this.script)}parseScriptParameters(e){this.shortName=e.shortName,this.longName=e.longName,this.author=e.author,this.description=e.description,this.firstScene=e.firstScene,this.scenes=e.scenes,this.language=e.language,this.updateState()}updateState(){ne.language=this.language}}class Fe{constructor(e){this._timedObjects=e,this._queue=this.build(),this._index=0,this.sort("asc")}get pending(){if(!(this._index>this._queue.length-1))return this._queue[this._index]}getTimedObject(e){return this._timedObjects[e]}advance(){this._index+=1}build(){const e=[];for(let t=0;t<this._timedObjects.length;t+=1){const n={id:t,time:this._timedObjects[t].in,action:b},i={id:t,time:this._timedObjects[t].out,action:g};e.push(n,i)}return e}sort(e){switch(e){case"desc":this._queue.sort((e,t)=>t.time-e.time);break;case"asc":default:this._queue.sort((e,t)=>e.time-t.time)}}}class we extends Error{}class xe{constructor(e){!function(e){U=M({},L,{},e)}(e.config),this.node=e.node,this.lastState=e.lastState,this.isClientSupported=e.isClientSupported,this.scene=null,this.story=new ge,this.story.readScript().then(()=>{this.loadScene(this.story.firstScene)}).catch(e=>{throw new we(e)}),this.updateStateTime()}loadScene(e,t){this.scene&&this.unloadScene(),setTimeout(()=>{t=t||!0,this.scene=new pe(this.story.scenes[e]),ne.scene=e,t&&ne.addToHistory(e)})}unloadScene(){this.scene.unmountComponents()}updateStateTime(){a.listen(v,e=>{e.detail.time&&(ne.time=_(e.detail.time))})}}var Oe=n(2);function je(e,t){const n=e,i=Oe.version;!function(e){a=new o(e)}(n),function(e){de=new le(e)}(n);const r=new xe({node:n,config:t,lastState:s.localStorage.getData(),isClientSupported:s.isCompatible()});return{reload(){r.loadScene(ne.scene)},pause(){a.broadcast(y)},play(){a.broadcast(m)},skipTo(e){r.loadScene(e)},currentTime:()=>ne.time,version:i,v:i}}n.d(t,"default",function(){return je})}]).default});