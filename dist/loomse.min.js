!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.LoomSE=t():e.LoomSE=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e){e.exports=JSON.parse('{"$schema":"http://json-schema.org/draft-07/schema#","title":"Script schema","description":"This document outlines the correct formatting for the script schema","type":"object","required":["firstScene","scenes"],"properties":{"shortName":{"type":"string","description":"A short, succinct title","default":""},"longName":{"type":"string","description":"A more verbose name for the script","default":""},"author":{"type":"string","description":"Name of the author","default":""},"description":{"type":"string","description":"A brief description of the story","default":""},"firstScene":{"type":"string","description":"The name of the first scene. Must exist in in scenes object.","default":""},"language":{"type":"string","description":"The default language of the story","examples":["en_GB"]},"scenes":{"type":"object","additionalProperties":{"type":"object","required":["video","events"],"properties":{"longName":{"type":"string","description":"Name of scene","default":""},"video":{"type":"object","required":["sources"],"properties":{"loop":{"properties":{"in":{"type":"integer","description":"Loop in point (in milliseconds)","minimum":0},"out":{"type":"integer","description":"Loop out point (in milliseconds)"}}},"autoplay":{"type":"boolean","description":"Autoplay video on load flag","default":false},"muted":{"type":"boolean","description":"Mute audio","default":false},"sources":{"type":"object","properties":{"mp4":{"type":"string","description":"Relative path to mp4 asset","default":""},"ogg":{"type":"string","description":"Relative path to ogg asset","default":""},"webm":{"type":"string","description":"Relative path to webm asset","default":""},"duration":{"type":"integer","description":"Length of video file"},"subtitles":{"type":"object","additionalProperties":{"type":"string","description":"Relative path to subtitles file","default":""}}}}}},"events":{"type":"array","items":{"$ref":"#/definitions/event"}}}}}},"definitions":{"event":{"type":"object","required":["in","out"],"properties":{"moduleName":{"type":"string","description":"References the external module name","default":""},"disabled":{"type":"boolean","description":"Flag to determine if the module should be disabled","default":false},"in":{"type":"integer","description":"Loop in point (in milliseconds)","default":0,"minimum":0},"out":{"type":"integer","description":"Loop out point (in milliseconds)","default":0},"x":{"type":"number","description":"x representational co-ordinate","default":0,"minimum":0,"maximum":1},"y":{"type":"number","description":"y representational co-ordinate","default":0,"minimum":0,"maximum":1},"payload":{"type":"object","description":"Additional data to pass into the module","default":{},"additionalProperties":true}}}}}')},function(e,t,n){var i;"undefined"!=typeof self&&self,e.exports=(i=n(3),function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={asExpression:function(e,t,n){return"function"!=typeof e?e:e(t,n)},hasProperty:function(e,t){return"object"===(void 0===e?"undefined":i(e))&&Object.prototype.hasOwnProperty.call(e,t)}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r={ANY_SCHEMA:{},NOT_ANY_SCHEMA:{not:{}}};e.exports={is:function(e){return"object"===(void 0===e?"undefined":i(e))||"boolean"==typeof e},make:function e(t){if("object"!==(void 0===t?"undefined":i(t))||null===t)return{enum:[t]};if(Array.isArray(t))return{items:t.map(e),additionalItems:!1};var n=Object.keys(t);return{properties:n.reduce(function(n,i){return Object.assign({},n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},i,e(t[i])))},{}),required:n}},transform:function(e){return!0===e?r.ANY_SCHEMA:!1===e?r.NOT_ANY_SCHEMA:e},transformation:r}},function(e,t,n){"use strict";function i(e){var t=e.defineErrors,n=e.index;return"\n    "+(t?"const errors = [];":"")+"\n    "+(n?"let i"+Array.apply(void 0,function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(Array(n))).map(function(e,t){return t+1}).join(",i")+";":"")+"\n  "}function r(e){var t=e.defineErrors,n=e.lines,r=t?"if(errors.length) return errors;":"";return'\n    "use strict";\n    '+i(e)+"\n    "+n.join("\n")+"\n    "+r+"\n  "}e.exports={body:function(e,t){var n=e.cachedIndex,i=e.lines,s=t.context,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={context:s,inner:o.inner,defineErrors:o.errorHandler,index:n,lines:i};return"\n    "+function(e){var t=e.context;if(e.inner||!t.length)return"";var n=[],i=[];return t.forEach(function(e,t){"number"!=typeof e?n.push(t+1+" = "+e):i.push(t+1+" = f"+(e+1))}),"const f"+n.concat(i).join(", f")+";"}(a)+"\n    function f0(data) {\n      "+r(a)+"\n    }\n    return f0;\n  "},restore:function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).inner,i=new Function("schema",e)(t);return n||(i.toString=function(){return e}),i},template:function(e,t){function n(e){for(var t=arguments.length,i=Array(t>1?t-1:0),r=1;r<t;r++)i[r-1]=arguments[r];var s=void 0;return n.lines.push(e.replace(/%i/g,function(){return"i"}).replace(/\$(\d)/g,function(e,t){return""+i[t-1]}).replace(/(%[sd])/g,function(){return i.length&&(s=i.shift()),""+s})),n}function i(e){return e.replace("[","").replace("]","").replace("(","").replace(")","").replace("decodeURIComponent","")}function r(){return this.join(".").replace(/\.\[/g,"[")}var s="function"==typeof t.errorHandler?t.errorHandler:function(e){var t=this.data.toString().replace(/^data/,""),n=t.replace(/\['([^']+)'\]/gi,".$1").replace(/\[(i[0-9]*)\]/gi,"['+$1+']"),r="#"+t.replace(/\[i([0-9]*)\]/gi,"/items").replace(/\['([^']+)'\]/gi,"/properties/$1")+"/"+e;return"return {\n        keyword: '"+e+"',\n        dataPath: decodeURIComponent(\""+i(n)+'"),\n        schemaPath: decodeURIComponent("'+i(r)+'")\n      };'};return Object.assign(n,{cachedIndex:0,cached:[],cache:function(e){var t=n.cached[n.cached.length-1];return t[e]?"i"+t[e]:(n.cachedIndex+=1,t[e]=n.cachedIndex,"(i"+t[e]+" = "+e+")")},data:["data"],error:s,lines:[],schema:["schema"],push:n,link:function(t){return"f"+e.link(t)},visit:function(t){n.cached.push({}),e.visit(t,n),n.cached.pop()}}),n.data.toString=r,n.schema.toString=r,n},expression:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return function(){for(var t=arguments.length,i=Array(t),r=0;r<t;r++)i[r]=arguments[r];var s=i[i.length-1]||{},o=[e[0]];return n.forEach(function(t,n){var r=Number.isInteger(t)?i[t]:s[t];o.push(r,e[n+1])}),o.join("")}}}},function(e,t,n){"use strict";function i(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var r=i(["!/^[a-zA-Z]+$/.test(",")"],["!/^[a-zA-Z]+$/.test(",")"]),s=i(["!/^[a-zA-Z0-9]+$/.test(",")"],["!/^[a-zA-Z0-9]+$/.test(",")"]),o=i(["!/^[-_a-zA-Z0-9]+$/.test(",")"],["!/^[-_a-zA-Z0-9]+$/.test(",")"]),a=i(["!/^[a-fA-F0-9]+$/.test(",")"],["!/^[a-fA-F0-9]+$/.test(",")"]),c=i(["!/^[0-9]+$/.test(",")"],["!/^[0-9]+$/.test(",")"]),u=i(["isNaN(Date.parse(",")) || ~",".indexOf('/')"],["isNaN(Date.parse(",")) || ~",".indexOf(\\'/\\')"]),f=i([""," !== ",".toUpperCase()"],[""," !== ",".toUpperCase()"]),l=i([""," !== ",".toLowerCase()"],[""," !== ",".toLowerCase()"]),d=i(["",".length >= 256 || !/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9])(\\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\-]{0,61}[a-zA-Z0-9]))*$/.test(",")"],["",".length >= 256 || !/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\\\-]{0,61}[a-zA-Z0-9])(\\\\.([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\\\\-]{0,61}[a-zA-Z0-9]))*$/.test(",")"]),p=i(["!/^[A-Za-z][A-Za-z0-9+\\-.]*:(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?$/.test(",")"],["!/^[A-Za-z][A-Za-z0-9+\\\\-.]*:(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?$/.test(",")"]),h=i(["!/^[^@]+@[^@]+\\.[^@]+$/.test(",")"],["!/^[^@]+@[^@]+\\\\.[^@]+$/.test(",")"]),m=i(["!/^(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}\\.(\\d?\\d?\\d){0,255}$/.test(",") || ",'.split(".")[3] > 255'],["!/^(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}\\\\.(\\\\d?\\\\d?\\\\d){0,255}$/.test(",") || ",'.split(".")[3] > 255']),y=i(["!/^((?=.*::)(?!.*::.+::)(::)?([\\dA-F]{1,4}:(:|\\b)|){5}|([\\dA-F]{1,4}:){6})((([\\dA-F]{1,4}((?!\\3)::|:\\b|$))|(?!\\2\\3)){2}|(((2[0-4]|1\\d|[1-9])?\\d|25[0-5])\\.?\\b){4})$/.test(",")"],["!/^((?=.*::)(?!.*::.+::)(::)?([\\\\dA-F]{1,4}:(:|\\\\b)|){5}|([\\\\dA-F]{1,4}:){6})((([\\\\dA-F]{1,4}((?!\\\\3)::|:\\\\b|$))|(?!\\\\2\\\\3)){2}|(((2[0-4]|1\\\\d|[1-9])?\\\\d|25[0-5])\\\\.?\\\\b){4})$/.test(",")"]),v=i(["/[^\\\\]\\\\[^.*+?^${}()|[\\]\\\\bBcdDfnrsStvwWxu0-9]/i.test(",")"],["/[^\\\\\\\\]\\\\\\\\[^.*+?^\\${}()|[\\\\]\\\\\\\\bBcdDfnrsStvwWxu0-9]/i.test(",")"]),b=i(["!/^$|^\\/(?:~(?=[01])|[^~])*$/i.test(",")"],["!/^$|^\\\\/(?:~(?=[01])|[^~])*$/i.test(",")"]),A=i(["!/^(?:[A-Za-z][A-Za-z0-9+\\-.]*:(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?|(?:\\/\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\.[A-Za-z0-9\\-._~!$&'()*+,;=:]+)\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\-._~!$&'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\/(?:(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\-._~!$&'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\\/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\?(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\#(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@\\/?]|%[0-9A-Fa-f]{2})*)?)$/i.test(",")"],["!/^(?:[A-Za-z][A-Za-z0-9+\\\\-.]*:(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?|(?:\\\\/\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]|%[0-9A-Fa-f]{2})*@)?(?:\\\\[(?:(?:(?:(?:[0-9A-Fa-f]{1,4}:){6}|::(?:[0-9A-Fa-f]{1,4}:){5}|(?:[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,1}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){3}|(?:(?:[0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})?::(?:[0-9A-Fa-f]{1,4}:){2}|(?:(?:[0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}:|(?:(?:[0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})?::)(?:[0-9A-Fa-f]{1,4}:[0-9A-Fa-f]{1,4}|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))|(?:(?:[0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})?::[0-9A-Fa-f]{1,4}|(?:(?:[0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})?::)|[Vv][0-9A-Fa-f]+\\\\.[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:]+)\\\\]|(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=]|%[0-9A-Fa-f]{2})*)(?::[0-9]*)?(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|\\\\/(?:(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*)?|(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=@]|%[0-9A-Fa-f]{2})+(?:\\\\/(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@]|%[0-9A-Fa-f]{2})*)*|)(?:\\\\?(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?(?:\\\\#(?:[A-Za-z0-9\\\\-._~!$&\\'()*+,;=:@\\\\/?]|%[0-9A-Fa-f]{2})*)?)$/i.test(",")"]),g=i(["!/^(?:(?:[^\\x00-\\x20\"'<>%\\\\^`{|}]|%[0-9a-f]{2})|\\{[+#.\\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\:[1-9][0-9]{0,3}|\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\:[1-9][0-9]{0,3}|\\*)?)*\\})*$/i.test(",")"],["!/^(?:(?:[^\\\\x00-\\\\x20\"\\'<>%\\\\\\\\^\\`{|}]|%[0-9a-f]{2})|\\\\{[+#.\\\\/;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\\\:[1-9][0-9]{0,3}|\\\\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?:\\\\:[1-9][0-9]{0,3}|\\\\*)?)*\\\\})*$/i.test(",")"]),F=n(2).expression;e.exports={alpha:F(r,"data"),alphanumeric:F(s,"data"),identifier:F(o,"data"),hexadecimal:F(a,"data"),numeric:F(c,"data"),"date-time":F(u,"data","data"),uppercase:F(f,"data","data"),lowercase:F(l,"data","data"),hostname:F(d,"data","data"),uri:F(p,"data"),email:F(h,"data"),ipv4:F(m,"data","data"),ipv6:F(y,"data"),regex:F(v,"data"),"json-pointer":F(b,"data"),"uri-reference":F(A,"data"),"uri-template":F(g,"data")}},function(e,t,n){"use strict";var i=n(11),r=n(12),s=n(13),o=n(14),a=n(16),c=n(17),u=n(18),f=n(19),l=n(20),d=n(21),p=n(22),h=n(23),m=n(24),y=n(25),v=n(26),b=n(27);e.exports={name:{$ref:a,required:i,format:r,property:s,type:o,not:c,anyOf:u,oneOf:f,allOf:l,dependencies:d,properties:p,patternProperties:h,items:m,contains:y,constant:v,propertyNames:b},list:[a,i,r,s,o,c,u,f,l,d,p,h,m,y,v,b]}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports={readOnly:"false",exclusiveMinimum:function(e){return"%s <= "+e.exclusiveMinimum},minimum:function(e){return"%s < "+e.minimum},exclusiveMaximum:function(e){return"%s >= "+e.exclusiveMaximum},maximum:function(e){return"%s > "+e.maximum},multipleOf:'($1/$2) % 1 !== 0 && typeof $1 === "number"',pattern:function(e){var t=void 0,n=void 0;return"string"==typeof e.pattern?t=e.pattern:(t=e.pattern[0],n=e.pattern[1]),'typeof ($1) === "string" && !'+new RegExp(t,n)+".test($1)"},minLength:'typeof $1 === "string" && function dltml(b,c){for(var a=0,d=b.length;a<d&&c;){var e=b.charCodeAt(a++);55296<=e&&56319>=e&&a<d&&56320!==(b.charCodeAt(a++)&64512)&&a--;c--}return!!c}($1, $2)',maxLength:'typeof $1 === "string" && function dmtml(b,c){for(var a=0,d=b.length;a<d&&0<=c;){var e=b.charCodeAt(a++);55296<=e&&56319>=e&&a<d&&56320!==(b.charCodeAt(a++)&64512)&&a--;c--}return 0>c}($1, $2)',minItems:"$1.length < $2 && Array.isArray($1)",maxItems:"$1.length > $2 && Array.isArray($1)",uniqueItems:function(e,t){return e.uniqueItems?(t(t.cache("{}")),'Array.isArray($1) && $1.some(function(item, key) {\n      if(item !== null && typeof item === "object") key = JSON.stringify(item);\n      else key = item;\n      if('+t.cache("{}")+".hasOwnProperty(key)) return true;\n      "+t.cache("{}")+"[key] = true;\n    })"):"true"},minProperties:'!Array.isArray($1) && typeof $1 === "object" && Object.keys($1).length < $2',maxProperties:'!Array.isArray($1) && typeof $1 === "object" && Object.keys($1).length > $2',enum:function(e,t){return e.enum.map(function(e){var n="$1",r=e;return"object"===(void 0===e?"undefined":i(e))?(r="'"+JSON.stringify(e)+"'",n=t.cache("JSON.stringify($1)")):"string"==typeof e&&(r="'"+encodeURIComponent(e)+"'"),n+" != decodeURIComponent("+r+")"}).join(" && ")}}},function(e,t,n){"use strict";e.exports=["$ref","$schema","type","not","anyOf","allOf","oneOf","properties","patternProperties","additionalProperties","items","additionalItems","required","default","title","description","definitions","dependencies","$id","contains","const","examples"]},function(e,t,n){"use strict";function i(e){return r.test(e)}var r=/:\/\//,s=/#\/?/,o=/(^[^:]+:\/\/[^?#]*\/).*/;e.exports={makePath:function(e){return e.filter(function(e){return"string"==typeof e}).reduce(function(e,t){if(!e.length||i(t))return t;if(!t)return e;if(0===t.indexOf("#")){var n=e.indexOf("#");return-1===n?e+t:e.slice(0,n)+t}var r=function(e){return e.replace(o,"$1")}(e)+t;return r+(-1===r.indexOf("#")?"#":"")},"")},isFullUri:i,head:function(e){return"string"!=typeof e?e:e.split(s)[0]},fragment:function(e){return"string"!=typeof e?e:e.split(s)[1]},normalize:function(e){return decodeURIComponent(e.replace(/~1/g,"/").replace(/~0/g,"~"))},keys:{id:"$id"}}},function(e,t,n){e.exports=n(9)},function(e,t,n){"use strict";function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!(this instanceof i))return new i(e);this.options=e,this.resolved={},this.state=new l(null,this),this.useVersion(e.version,e.versionConfigure),this.addFormat(e.formats)}var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n(2),o=s.restore,a=s.expression,c=n(3),u=n(10),f=u.generate,l=u.State,d=n(28),p=d.add,h=d.use;Object.assign(i,{expression:a}),Object.assign(i.prototype,{validate:function(e,t){return this.resolve(e).fn(t)},addSchema:function(e,t){var n=this,i="object"===(void 0===e?"undefined":r(e))?e:t,s={schema:i,fn:f(this,i,void 0,this.options)};return[e,t.id].filter(function(e){return"string"==typeof e}).forEach(function(e){n.resolved[e]=Object.assign({name:e},s)}),s},removeSchema:function(e){e?delete this.resolved[e]:this.resolved={}},resolve:function(e){return"object"!==(void 0===e?"undefined":r(e))&&this.resolved[e]?this.resolved[e]:this.addSchema(e,this.state.resolve(e))},export:function(e){var t=this,n=void 0;return e?n={name:e,schema:(n=this.resolve(e)).schema,fn:n.fn.toString()}:(n={},Object.keys(this.resolved).forEach(function(e){n[e]={name:e,schema:t.resolved[e].schema,fn:t.resolved[e].fn.toString()}})),JSON.stringify(n)},import:function(e){var t=this,n=JSON.parse(e),i=n;n.name&&n.fn&&n.schema&&(i=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n.name,n)),Object.keys(i).forEach(function(e){var n=i[e],r=n.name,s=n.schema,a=n.fn,c=o(a,s,t.options);t.resolved[r]={name:r,schema:s,fn:c}})},addFormat:function(e,t){"string"!=typeof e?"object"===(void 0===e?"undefined":r(e))&&Object.assign(c,e):c[e]=t},setErrorHandler:function(e){Object.assign(this.options,{errorHandler:e})},useVersion:function(e,t){"function"!=typeof t&&"draft-04"===e&&(t=n(29)),"function"==typeof t&&p(e,t),h(e)}}),e.exports=i},function(e,t,n){"use strict";function i(){var e=(arguments.length>0&&void 0!==arguments[0]&&arguments[0],arguments[1]);Object.assign(this,{context:[],entries:new Map,env:e})}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new i(t,e),r=arguments[3],s=u(n,r);s.visit(t);var o=a(s,n,r);return c(o,t,r)}var s=n(4).list,o=n(2),a=o.body,c=o.restore,u=o.template,f=n(0).hasProperty,l=n(7),d=l.normalize,p=l.makePath,h=l.head,m=l.isFullUri,y=l.fragment,v=l.keys,b=n(1),A=b.is,g=b.transform;i.prototype=Object.assign(Object.create(Array.prototype),{addEntry:function(e,t){var n=this.entries.get(t);return!1===n?this.context.push(t):(void 0===n&&(this.entries.set(t,!1),n=r(this.env,t,this,{inner:!0}),this.entries.set(t,n),this.revealReference(t)),this.context.push(n))},revealReference:function(e){for(var t=this.context.indexOf(e);-1!==t;t=this.context.indexOf(e))this.context[t]=this.context.length},link:function(e){var t=this.resolve(e);return this.addEntry(e,t)},resolveReference:function(e){if(m(e))return e;for(var t=void 0,n=void 0,i=this.length-1;i>=0;i-=1,t=!1){var r=this[i],s=r[v.id],o=r.$ref;if(m(t=s||o)){n=i;break}}for(var a=[],c=this.length-1;c>n;c-=1){var u=this[c],f=u[v.id],l=u.$ref,d=f||l;h(d)&&a.push(d)}return p([t].concat(a,[e]))},ascend:function(e){for(var t=h(e),n=(this.env.resolved[t]||{}).schema,i=void 0===n?this[0]:n;i.$ref&&h(i.$ref)!==h(e)&&1===Object.keys(i).length;)i=this.ascend(i.$ref);return i},descend:function(e,t){var n=this,i=y(e);if(!i&&m(e))return t;i||(i=e);var r=i.split("/"),s=r.map(d).reduce(function(e,t,i){var s=e[t];return A(s)||(s=e.definitions&&e.definitions[t]),i!==r.length-1&&f(s,v.id)&&n.push(s),s},t);return A(s)?s:t},resolve:function(e){if("string"!=typeof e)return e;var t=this.resolveReference(e),n=this.ascend(t);return this.descend(e,n)},visit:function(e,t){var n=g(e),i=this.length;this.push(n),s.some(function(e){return e(n,t)}),this.length=i}}),e.exports={State:i,generate:r}},function(e,t,n){"use strict";e.exports=function(e,t){Array.isArray(e.required)&&t("if ("+t.data+" !== null && typeof "+t.data+" === 'object' && !Array.isArray("+t.data+")) {\n    "+e.required.map(function(e){return"if (!"+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(e)+'"))) '+t.error("required",e)}).join("")+"\n  }")}},function(e,t,n){"use strict";var i=n(3);e.exports=function(e,t){if(void 0!==e.format){var n=i[e.format];"function"==typeof n&&t("if ("+n({data:t.data,schema:e})+") "+t.error("format"))}}},function(e,t,n){"use strict";var i=n(5),r=n(6),s=n(0).asExpression;e.exports=function(e,t){Object.keys(e).forEach(function(n){if(-1===r.indexOf(n)&&"format"!==n){var o=s(i[n],e,t);if(o){var a=t.error(n);t("if ("+o+") "+a,t.data,e[n])}}})}},function(e,t,n){"use strict";var i=n(15),r=n(0).hasProperty;e.exports=function(e,t){if(r(e,"type")){var n=t.error("type",e.type);t("if (("+[].concat(e.type).map(function(e){return i[e]}).join(") && (")+")) "+n,t.data)}}},function(e,t,n){"use strict";e.exports={null:"%s !== null",string:'typeof %s !== "string"',boolean:'typeof %s !== "boolean"',number:'typeof %s !== "number" || %s !== %s',integer:'typeof %s !== "number" || %s % 1 !== 0',object:'!%s || typeof %s !== "object" || Array.isArray(%s)',array:"!Array.isArray(%s)",date:"!(%s instanceof Date)"}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){return!!i(e,"$ref")&&(t("if ("+t.link(e.$ref)+"("+t.data+")) "+t.error("$ref")),!0)}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){i(e,"not")&&t("if (!"+t.link(e.not)+"("+t.data+")) "+t.error("not"))}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){if(i(e,"anyOf")){var n=t.error("anyOf"),r=e.anyOf.map(function(e){return t.link(e)+"("+t.data+")"}).join(" && ");t("if ("+r+") "+n)}}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){if(i(e,"oneOf")){var n=e.oneOf.map(function(e){return t.link(e)}),r=t.cache("["+n+"]"),s=t.cache("["+n+"]"),o=t.cache(s+".length - 1"),a=t.cache(s+".length - 1"),c=t.cache("0"),u=t.cache("0"),f=t.error("oneOf");t("for (\n    "+r+", "+o+", "+c+";\n    "+a+" >= 0 && "+a+" < "+s+".length;\n    "+a+"--) {\n      if(!"+s+"["+a+"]("+t.data+")) "+u+"++;\n    }\n    if ("+u+" !== 1) "+f+"\n  ")}}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){if(i(e,"allOf")){var n=t.error("allOf"),r=e.allOf.map(function(e){return t.link(e)+"("+t.data+")"}).join(" || ");t("if ("+r+") "+n)}}},function(e,t,n){"use strict";var i=n(0).hasProperty,r=n(1).is;e.exports=function(e,t){i(e,"dependencies")&&Object.keys(e.dependencies).forEach(function(n){var i=e.dependencies[n],s=t.error("dependencies");t("if ("+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(n)+'"))) {'),Array.isArray(i)||"string"==typeof i?[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(i)).map(function(e){return"if (!"+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(e)+'"))) '+s}).map(t):r(i)&&t.visit(i),t("}")})}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(0).hasProperty;e.exports=function(e,t){r(e,"properties")&&"object"===i(e.properties)&&Object.keys(e.properties).forEach(function(n){var r=e.properties[n];if("object"!==(void 0===r?"undefined":i(r))||Object.keys(r).length){var s=!e.required||-1===e.required.indexOf(n);s&&t("if ("+t.data+'.hasOwnProperty(decodeURIComponent("'+encodeURIComponent(n)+'"))) {'),t.data.push("[decodeURIComponent('"+encodeURIComponent(n)+"')]"),t.visit(r),t.data.pop(),s&&t("}")}})}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){var n=i(e,"additionalProperties")&&!0!==e.additionalProperties,r=i(e,"patternProperties");if(n||r){t("if(typeof "+t.data+" === 'object' && !Array.isArray("+t.data+")) {"),t(t.cache("null"));var s=t.cache("null"),o=function(){!1===e.additionalProperties?t(t.error("additionalProperties")):e.additionalProperties&&(t.data.push("["+s+"]"),t.visit(e.additionalProperties),t.data.pop())};t("for ("+s+" in "+t.data+") {"),n&&r&&t(t.cache("false")),r?Object.keys(e.patternProperties).forEach(function(i){t("if ("+new RegExp(i)+".test("+s+")) {"),n&&t(t.cache("false")+" = true;");var r=e.patternProperties[i];t.data.push("["+s+"]"),t.visit(r),t.data.pop(),t("}"),e.properties?t("if ("+(n?t.cache("false")+" || ":"")+" "+t.schema+".properties.hasOwnProperty("+s+")) continue;"):n&&t("if ("+t.cache("false")+") continue;"),o()}):(e.properties&&t("if("+t.schema+".properties.hasOwnProperty("+s+")) continue;"),o()),t("}}")}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(0).hasProperty;e.exports=function(e,t){if(r(e,"items")){var n=e.items.length,s=t.error("additionalItems"),o=t.data;if(t("if(Array.isArray("+o+")) {"),Array.isArray(e.items)){if(!1===e.additionalItems&&t("if ("+o+".length > "+n+") "+s),e.items.forEach(function(e,n){t("if("+o+".length > "+n+") {"),o.push("["+n+"]"),t.visit(e),o.pop(),t("}")}),"object"===i(e.additionalItems)){var a=t.cache(n),c=t.cache(n);t("for ("+a+"; "+c+" < "+o+".length; "+c+"++) {"),o.push("["+t.cache(n)+"]"),t.visit(e.additionalItems),o.pop(),t("}")}}else{var u=t.cache("0"),f=t.cache("0");t("for ("+u+"; "+f+" < "+o+".length; "+f+"++) {"),o.push("["+f+"]"),t.visit(e.items),o.pop(),t("}")}t("}")}}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){if(i(e,"contains")){var n=t.error("contains"),r=""+t.link(e.contains),s=t.data,o=t.cache("0"),a=t.cache("0");t("if (Array.isArray("+s+")) {\n    if ("+s+".length === 0) "+n+"\n      for ("+o+"; "+a+" < "+s+".length; "+a+"++) {\n        if (!"+r+"("+s.toString.apply(s.concat("["+a+"]"))+")) break;\n        if ("+a+" === "+s+".length - 1) "+n+"\n      }\n  }")}}},function(e,t,n){"use strict";var i=n(0).hasProperty,r=n(1).make;e.exports=function(e,t){if(i(e,"const")){var n=r(e.const);t.visit(n)}}},function(e,t,n){"use strict";var i=n(0).hasProperty;e.exports=function(e,t){if(i(e,"propertyNames")){var n=t.link(e.propertyNames),r=t.error("propertyNames");t("if (Object.keys("+t.data+").some("+n+")) "+r)}}},function(e,t,n){"use strict";var i=n(5),r=n(6),s=n(4),o=n(3),a=n(7).keys,c=n(1).transformation,u={};e.exports={add:function(e,t){u[e]=t},use:function(e){e&&u[e]&&(0,u[e])({properties:i,keywords:r,validators:s,formats:o,keys:a,transformation:c})}}},function(e,t){e.exports=i}]))},function(e){e.exports=JSON.parse('{"private":false,"name":"loomse","version":"0.5.9","description":"Interactive storytelling for the modern web","author":"Franco Speziali","license":"GPL-3.0","homepage":"http://www.loomse.org/","repository":{"type":"git","url":"https://github.com/WeMakeMachines/loomse.git"},"main":"dist/loomse.min.js","scripts":{"dev":"webpack --config webpack.config.js --devtool=\'source-map\' --watch --mode=\'development\'","build":"webpack --config webpack.config.js --mode=\'production\' -o dist/loomse.min.js","prettier":"prettier --write \'source/**/*.js\'","eslint":"eslint source","test":"jest"},"devDependencies":{"@babel/cli":"^7.5.5","@babel/core":"^7.5.5","@babel/preset-env":"^7.5.5","babel-eslint":"^10.0.2","babel-jest":"^24.8.0","babel-loader":"^8.0.6","eslint":"^6.1.0","eslint-plugin-jest":"^22.14.1","jest":"^24.8.0","prettier":"1.17.1","webpack":"^4.35.0","webpack-cli":"^3.3.4"},"dependencies":{"djv":"^2.1.3-alpha.0"}}')},function(e,t,n){!function(){"use strict";e.exports=function(e){var t=e.properties,n=e.keywords,i=e.validators,r=e.formats,s=e.keys,o=e.transformation;Object.assign(t,{minimum:function(e){return"%s <"+(e.exclusiveMinimum?"=":"")+" "+e.minimum},maximum:function(e){return"%s >"+(e.exclusiveMaximum?"=":"")+" "+e.maximum}}),delete t.exclusiveMaximum,delete t.exclusiveMinimum,["$id","contains","const","examples"].forEach(function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}),-1===n.indexOf("exclusiveMaximum")&&n.push("exclusiveMaximum","exclusiveMininum","id"),["contains","constant","propertyNames"].forEach(function(e){var t=i.name[e];delete i.name[e];var n=i.list.indexOf(t);-1!==n&&i.list.splice(n,1)}),delete r["json-pointer"],delete r["uri-reference"],delete r["uri-template"],Object.assign(s,{id:"id"}),Object.assign(o,{ANY_SCHEMA:!0,NOT_ANY_SCHEMA:!1})}}()},function(e,t,n){"use strict";n.r(t);class i{constructor(e){this.antenna=e}broadcast(e,t){const n=new CustomEvent(e,{detail:t});this.antenna.dispatchEvent(n)}listen(e,t){this.antenna.addEventListener(e,t)}stopListening(e,t){this.antenna.removeEventListener(e,t)}}let r;class s extends Error{}class o{static createNode(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div";return document.createElement(e)}static createTextNode(e){return e?document.createTextNode(e):null}constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.node=e.node&&"object"==typeof e.node?e.node:this.constructor.createNode(e.type),this.mounted=!1,this.parent=e.parent||null,this.visible=e.visible||!0,this._childRegistry=e.children||[],this._eventHandlerRegistry={},this.visible||this.hide(),e.id&&this.setId(e.id),e.text&&this.node.appendChild(this.constructor.createTextNode(e.text)),e.class&&this.setClass(e.class),e.layer&&this.setLayer(e.layer),e.styles&&this.setStyles(e.styles),this.setStyles({position:"absolute",top:0,left:0})}get children(){return this._childRegistry}attach(e){this._childRegistry.push(e),this.node.appendChild(e.node),e.mounted=!0,e.parent=this.node}removeChildren(){this._childRegistry.forEach(e=>{e.mounted&&(e.unmount(),e.mounted=!1)})}mount(){if(this.mounted)throw new s("Component already mounted");if(this.parent&&"object"==typeof this.parent&&this.parent.appendChild)return this.parent.appendChild(this.node),void(this.mounted=!0);throw new s("Parent not found")}mountTo(e){if(this.mounted)throw new s("Component already mounted");if(e&&"object"==typeof e&&e.appendChild)return this.parent=e,this.parent.appendChild(this.node),void(this.mounted=!0);throw new s("Parent not found")}unmount(){if(this.mounted){if(!this.parent)throw new s("Parent not found");this.parent.removeChild(this.node),this.mounted=!1}}setClass(e){if(!e||"string"!=typeof e&&!Array.isArray(e))throw new s("[Element] invalid parameters");(e="string"==typeof e?[e]:e).forEach(e=>{this.node.classList.add(e)})}setAttributes(e){if("object"!=typeof e)throw new s("Invalid attributes");for(const t in e)e.hasOwnProperty(t)&&this.node.setAttribute(t,e[t])}setId(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(!e)return;if(document.getElementById(e))throw new s("ID already in use");this.node.setAttribute("id",e)}setStyles(e){if("object"!=typeof e)throw new s("Invalid properties");for(const t in e){if(!e.hasOwnProperty(t))continue;let n=e[t];if("number"==typeof n)switch(t){case"width":case"height":case"top":case"left":case"right":case"bottom":n+="px"}this.node.style[t]=n}}setLayer(e){this.setStyles({zIndex:e})}resize(e){this.setStyles({width:e.width,height:e.height})}show(){this.setStyles({visibility:"visible"})}hide(){this.setStyles({visibility:"hidden"})}getDimensions(){const e=document.getElementsByTagName("body")[0],t=this.node.cloneNode(!0);t.setAttribute("style","display: inline-block !important; position: absolute; left: 0; top: 0; z-index: -100"),e.appendChild(t);const n={width:t.clientWidth,height:t.clientHeight};return e.removeChild(t),n}setPositionFromPercentage(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if((e<0||e>1)&&(e=0),(t<0||t>1)&&(t=0),!this.parent)return void console.warn("Unable to set position; no parent set");const n=this.parent.offsetWidth-this.node.offsetWidth,i=this.parent.offsetHeight-this.node.offsetHeight,r={x:Math.round(n*e),y:Math.round(i*t)};this.setStyles({left:r.x,top:r.y})}listenToChannel(e,t){this._eventHandlerRegistry[e]?console.warn("Already listening to channel, ",e):(this._eventHandlerRegistry[e]=t.bind(this),r.listen(e,this._eventHandlerRegistry[e]))}stopListeningToChannel(e){this._eventHandlerRegistry[e]?(r.stopListening(e,this._eventHandlerRegistry[e]),delete this._eventHandlerRegistry[e]):console.warn("Handler not found, ",e)}}class a extends o{constructor(e){super(e),this.x=e.x,this.y=e.y}render(){this.mount(),this.x&&this.y&&this.setPositionFromPercentage(this.x,this.y)}}const c="expired",u="fired",f="waiting";class l{constructor(e){this.id=e.id,this.state=f,this.module="function"==typeof e.module?e.module:null,this.disabled=e.disabled,this.in=e.in,this.out=e.out,this.x=e.x,this.y=e.y,this.payload=e.payload,this.parent=e.parent,this.element=new a({type:"div",id:"module-".concat(e.id),x:e.x,y:e.y,parent:e.parent})}run(){this.module&&(this.module().run(this.payload,this.element.node,()=>this.element.render()),this.state=u)}stop(){this.module&&(this.module().stop(),this.element.unmount(),this.state=c)}}const d="director:play",p="director:pause",h="video:timeupdate",m="stage:resize",y="run",v="stop";function b(e,t){return new Promise((n,i)=>{let r=new XMLHttpRequest;r.open("GET",e),r.send(),r.onload=()=>{if(200===r.status)switch(t){case"JSON":n(JSON.parse(r.responseText));break;default:n(r.responseText)}else i(r.status)},r.onerror=()=>{i("File or network error")}})}const A=(()=>{let e;return(t,n)=>{e&&clearTimeout(e),e=setTimeout(()=>{t()},n)}})();function g(e){const t=Object.keys(e);return!Boolean(t.length)}const F="srt";class w{static getBlockMarker(e){const t=Number(e);if(0!==t&&!isNaN(t))return t}static getTimes(e){if(-1===e.indexOf("--\x3e"))return;const t=e.split("--\x3e");return{in:P(t[0]),out:P(t[1])}}constructor(e){this.rawText=e,this.lines=this.processLines(),this.blocks=this.processBlocks()}processLines(){return this.rawText.split("\n")}processBlocks(){let e=0;return this.lines.reduce((t,n)=>{const i=this.constructor.getBlockMarker(n),r=this.constructor.getTimes(n),s=t[t.length-1];return i&&i===e+1?(e+=1,t.push({payload:{index:i,text:""}})):r?(s.in=r.in,s.out=r.out):s.payload.text+=n,t},[])}}async function O(e,t){if(!e||"string"!=typeof e)return;t=t||function(e){return e.split("/").pop().split(".").pop().toLowerCase()}(e);const n=await b(e);let i;switch(t){case F:i=await(r=n,new Promise((e,t)=>{"string"!=typeof r&&t();const n=new w(r);n.blocks||t(),e(n.blocks)}));break;default:Promise.reject("Unable to parse file")}var r;return Promise.resolve(i)}const x=60,j=60,S=1e3;function $(e){return e*S}function P(e,t){t=Object.assign({},t,{major:":",minor:","});const n=e.split(t.major),i=n.pop().split(t.minor),r=Number(n[0]),s=Number(n[1]),o=Number(i[0]),a=Number(i[1]);let c=r*x;return c=((c=(c+s)*j)+o)*S,c+=a}class _ extends o{constructor(e,t,n){super({id:e,styles:t}),this.activeEvents={},this.queue=new Se(n),this.listenToChannel(h,this.isReadyToAction)}stopListeningToRadio(){this.stopListeningToChannel(h)}isReadyToAction(e){if(!e.detail.time)return;const t=$(e.detail.time);t&&this.queue.pending&&t>=this.queue.pending.time&&this.parseAction(this.queue.pending)}parseAction(e){switch(e.action){case y:this.run(e);break;case v:this.stop(e);break;default:return}this.queue.advance()}run(){}stop(){}}const z={width:"100%",height:"100%",position:"absolute",left:0,top:0};function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var k={events:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(n,!0).forEach(function(t){Z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},z)};function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class T extends _{constructor(e){super("events",k.events,e),this.listenToChannel(m,this.resizeEvents)}resizeEvents(){for(const e in this.activeEvents)this.activeEvents.hasOwnProperty(e)&&this.activeEvents[e].element.setPositionFromPercentage(this.activeEvents[e].x,this.activeEvents[e].y)}run(e){this.activeEvents[e.id]=new l(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach(function(t){N(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({id:e.id,parent:this.node},this.queue.getTimedObject(e.id))),this.activeEvents[e.id].run()}stop(e){this.activeEvents[e.id].stop(),delete this.activeEvents[e.id]}}function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function D(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(n,!0).forEach(function(t){I(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const M={scriptJson:{},mobileScriptJson:{},scriptUri:"",mobileScriptUri:"",externalModules:"",resizeVideoTo:"parent",videoStretchMethod:"cover",mobileMinimumResolution:480,subtitles:{active:!1,x:.5,y:.9}};let q=D({},M);function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var H={subtitles:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(n,!0).forEach(function(t){L(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},z),subtitle:{display:"block",textAlign:"center",fontSize:"19px",color:"#ffffff",fontFamily:"Roboto, sans-serif"}};class J extends _{constructor(e){super("subtitles",H.subtitles,e)}run(e){const t=this.queue.getTimedObject(e.id);this.activeEvents[e.id]=new a({type:"p",id:"subtitle-".concat(e.id),styles:H.subtitle,x:q.subtitles.x,y:q.subtitles.y,text:t.payload.text,parent:this.node}),this.activeEvents[e.id].render()}stop(e){this.activeEvents[e.id].unmount(),delete this.activeEvents[e.id]}}const V="mp4",B="ogg",W="webm",Y="video/mp4",G="video/ogg",K="video/webm";class X extends Error{}class Q{static mapFileFormatToMediaType(e){switch(e){case V:return Y;case B:return G;case W:return K;default:throw new X("Unable to process source in Video file")}}constructor(e,t){this.element=new o({type:"source"}),this.element.setAttributes({src:t,type:this.constructor.mapFileFormatToMediaType(e)})}}const ee=new class{constructor(e){this._time=e.time,this._scene=e.scene,this._clientDimensions=e.clientDimensions,this._history=e.history,this._events=e.events,this._language=e.language}get events(){return this._events}set events(e){this._events=e}get time(){return this._time}set time(e){this._time=e}get scene(){return this._scene}set scene(e){this._scene=e}get language(){return this._language}set language(e){this._language=e}get clientDimensions(){return this._clientDimensions}set clientDimensions(e){"object"==typeof e&&(this._clientDimensions.width=e.width,this._clientDimensions.height=e.height)}addToHistory(e){this._history.push(e)}}({time:0,clientDimensions:{width:null,height:null},scene:"",events:[],history:[],language:"en_GB"});function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ie={video:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(n,!0).forEach(function(t){ne(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},z)};function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,i)}return n}function se(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class oe extends Error{}class ae extends o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q;super({type:"video",styles:function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(n,!0).forEach(function(t){se(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},ie.video,{objectFit:t.videoStretchMethod})}),this.node.autoplay=!1,this.node.controls=e.controls,this.node.loop=e.loop,this.node.muted=e.muted||!1,this.sources=this.setSources(e.sources),this.mountSources(),this.registerMediaEvents(),this.listenToChannel(p,this.pause),this.listenToChannel(d,this.play),e.autoplay&&this.play()}setSources(e){if(!e)throw new oe("No video sources found");const t={};for(const n in e)e.hasOwnProperty(n)&&(t[n]=new Q(n,e[n]));return t}mountSources(){for(const e in this.sources){if(!this.sources.hasOwnProperty(e))continue;this.sources[e].element.mountTo(this.node)}}registerMediaEvents(){["playing","paused","seeking","seeked","timeupdate","ended"].forEach(e=>{this.node.addEventListener(e,()=>{r.broadcast("video:".concat(e),{state:e,time:this.node.currentTime})})})}stopListeningToRadio(){this.stopListeningToChannel(p),this.stopListeningToChannel(d)}play(){this.node.play().then(()=>{this.resize({width:ee.clientDimensions.width,height:ee.clientDimensions.height})}).catch(()=>{})}pause(){this.node.pause()}playPause(){return this.node.paused?(this.play(),!0):(this.pause(),!1)}}class ce extends o{}class ue extends o{}class fe{static vendorAPI(){return{universal:{isAvailable:"fullscreenEnabled",request:"requestFullscreen",exit:"exitFullscreen",event:"fullscreenchange"},webkit:{isAvailable:"webkitFullscreenEnabled",request:"webkitRequestFullscreen",exit:"webkitExitFullscreen",event:"webkitfullscreenchange"},moz:{isAvailable:"mozFullScreenEnabled",request:"mozRequestFullScreen",exit:"mozCancelFullScreen",event:"mozfullscreenchange"},ms:{isAvailable:"msFullscreenEnabled",request:"msRequestFullscreen",exit:"msExitFullscreen",event:"MSFullscreenChange"}}}static returnVendorAPI(){let e=this.vendorAPI(),t=Object.keys(e);for(let n=0;n<t.length;n+=1){let i=e[t[n]],r=i.isAvailable;if(document[r])return i}return null}constructor(e){this.element=e,this.root=document,this.state=!1,this.api=this.constructor.returnVendorAPI(),this.isAvailable=Boolean(this.api)}toggle(){if(!this.isAvailable)throw new Error("Fullscreen not available on this device");this.state?this.exit():this.request(this.element)}request(e){e[this.api.request](),this.state=!0}exit(){this.root[this.api.exit](),this.state=!1}returnEvent(){return this.api.event||null}}class le extends Error{}const de=new class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window;this.ref=e,this.storageKey="data",this.data={},this.isAvailable=this.checkIsAvailable()}checkIsAvailable(){try{return this.isAvailable=!0,this.ref.localStorage.setItem("test",{}),this.ref.localStorage.removeItem("test"),!0}catch(e){throw new le("Unable to access local storage, ".concat(e))}}getData(){if(!this.isAvailable)return;const e=this.ref.localStorage.getItem(this.storageKey);return e?(this.data=JSON.parse(e),this.data):void 0}saveData(e,t){if(!this.isAvailable)return;this.data[e]||(this.data[e]=[]),this.data[e].push(t);const n=JSON.stringify(this.data);try{this.ref.localStorage.setItem(this.storageKey,n)}catch(e){throw new le("Unable to access local storage, ".concat(e))}}};function pe(){return{width:Math.min(document.body.clientWidth,window.innerWidth),height:window.innerHeight}}function he(){return function(){let e=document.createElement("video").canPlayType;return Boolean(e)}()}var me={view:{zIndex:0,backgroundColor:"#170508"}};class ye extends o{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:q;var n;super({parent:e,id:"view",styles:me.view}),this.resizeVideoTo=t.resizeVideoTo,this.fullscreen=(n=this.node,new fe(n)),this.containers={stage:new ce({id:"stage",layer:0}),overlay:new ue({id:"overlay",layer:1})},this.mountContainers(),this.mount(),this.setListeners(),this.updateClientDimensions()}mountContainers(){for(const e in this.containers){if(!this.containers.hasOwnProperty(e))continue;this.containers[e].mountTo(this.node)}}setListeners(){const e=this.fullscreen.returnEvent(),t=this.updateClientDimensions.bind(this);window.addEventListener("resize",function(){A(t,200)}),e&&document.addEventListener(e,function(){t()})}updateClientDimensions(){switch(this.resizeVideoTo){default:case"parent":ee.clientDimensions=function(e){const t=e.getBoundingClientRect();return{width:t.width,height:t.height}}(this.parent);break;case"window":ee.clientDimensions=pe()}this.resizeComponents()}resizeComponents(){[this,this.containers.stage,this.containers.overlay,...this.containers.stage.children,...this.containers.overlay.children].forEach(e=>e.resize({width:ee.clientDimensions.width,height:ee.clientDimensions.height})),r.broadcast(m,{width:ee.clientDimensions.width,height:ee.clientDimensions.height})}}let ve;class be{constructor(e){this.longName=e.longName,this.video=new ae(e.video),this.events=new T(this.parseEvents(e.events)),this.mountComponents(this.video,this.events),q.subtitles.active&&O(e.video.subtitles[ee.language]).then(e=>{this.subtitles=new J(e),this.mountComponents(this.subtitles)}).catch(e=>{console.warn(e)})}parseEvents(e){return e.map(e=>{const t=function(e,t){if(!e)return;const n=window[e][t];if(!n)throw new Error("No modules found");return n}(q.externalModules,e.moduleName);return t&&(e.module=t),e})}mountComponents(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.forEach(e=>ve.containers.stage.attach(e))}unmountComponents(){this.video.stopListeningToRadio(),this.events.stopListeningToRadio(),ve.containers.stage.removeChildren()}}var Ae=n(0),ge=n(1),Fe=n.n(ge);class we extends Error{}class Oe{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ae;this.schema=e}loadFromUri(e){return new Promise(t=>{b(e,"JSON").then(e=>t(e)).catch(e=>{throw new we("Unable to read script, ".concat(e))})})}validate(e){const t=new Fe.a;t.addSchema("script",this.schema);const n=t.validate("script",e);if(!n)return!0;throw new we("Script error, does not match schema, ".concat(JSON.stringify(n)))}}class xe extends Error{}class je{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:q;this.hasSmallScreen=function(e){let t=pe();return t.width<e||t.height<e}(e.mobileMinimumResolution),this.scriptJson=e.script||{},this.mobileScriptJson=e.mobileScriptJson||{},this.scriptUri=e.scriptUri,this.mobileScriptUri=e.mobileScriptUri,this.scriptReader=new Oe,this.json={},this.shortName="",this.longName="",this.author="",this.description="",this.firstScene="",this.scenes={},this.language=""}getJson(){return this.hasSmallScreen&&g(this.mobileScriptJson)?this.scriptReader.loadFromUri(this.mobileScriptUri):this.hasSmallScreen?this.mobileScriptJson:g(this.scriptJson)?this.scriptReader.loadFromUri(this.scriptUri):this.scriptJson}async readScript(){if(this.json=await this.getJson(),!this.scriptReader.validate(this.json))throw new xe("Unable to continue");this.parseScriptParameters(this.json)}parseScriptParameters(e){this.shortName=e.shortName,this.longName=e.longName,this.author=e.author,this.description=e.description,this.firstScene=e.firstScene,this.scenes=e.scenes,this.language=e.language,this.updateState()}updateState(){ee.language=this.language}}class Se{constructor(e){this._timedObjects=e,this._queue=this.build(),this._index=0,this.sort("asc")}get pending(){if(!(this._index>this._queue.length-1))return this._queue[this._index]}getTimedObject(e){return this._timedObjects[e]}advance(){this._index+=1}build(){const e=[];for(let t=0;t<this._timedObjects.length;t+=1){const n={id:t,time:this._timedObjects[t].in,action:y},i={id:t,time:this._timedObjects[t].out,action:v};e.push(n,i)}return e}sort(e){switch(e){case"desc":this._queue.sort((e,t)=>t.time-e.time);break;case"asc":default:this._queue.sort((e,t)=>e.time-t.time)}}}class $e extends Error{}class Pe{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee;var n,i;n=e.initialParameters,q=D({},M,{},n),i=e.parent,ve=new ye(i),this.lastState=e.lastState,this.isClientSupported=e.isClientSupported,this.scene=null,this.story=new je,this.state=t,this.story.readScript().then(()=>{this.loadScene(this.story.firstScene)}).catch(e=>{throw new $e(e)}),this.updateStateTime()}loadScene(e,t){this.scene&&this.unloadScene(),setTimeout(()=>{t=t||!0,this.scene=new be(this.story.scenes[e]),ee.scene=e,t&&ee.addToHistory(e)})}unloadScene(){this.scene.unmountComponents()}updateStateTime(){r.listen(h,e=>{e.detail.time&&(ee.time=$(e.detail.time))})}}var _e=n(2);function ze(e,t){const n=_e.version;r=new i(e);const s=new Pe({parent:e,initialParameters:t,lastState:de.getData(),isClientSupported:he()});return{reload(){s.loadScene(s.state.scene)},pause(){r.broadcast(p)},play(){r.broadcast(d)},skipTo(e){s.loadScene(e)},currentTime:()=>s.state.time,version:n,v:n}}n.d(t,"default",function(){return ze})}]).default});